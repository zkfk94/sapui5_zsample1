(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{init:()=>w});const n="post-message-action";function o(e,t){function o(){return"function"==typeof e?e():e}function i(e){const i=o();var r;i&&e.origin===i.origin&&e.source===i&&((r=e.data).type===n&&"object"==typeof r.action?t(e.data.action):console.warn("Unknown message received",e.data))}return window.addEventListener("message",i),{dispose:function(){window.removeEventListener("message",i)},sendAction:function(e){const t=o();if(!t)return;const i={type:n,action:e};t.postMessage(i,t.origin)}}}const i="string",r="input";const a=(s="[ext]",function(e){const t=[s,e].join(" ");function n(e){return{type:t,payload:e}}var o;return n.type=t,n.match=(o=t,function(e){return(null==e?void 0:e.type)===o}),n});var s;const c=a("control-selected"),l=a("select-control"),p=a("outline-changed"),u=a("change-property"),d=a("change-property-failed"),y=/src|.*icon$|^icon.*/i;function g(e){const t={primitiveType:"any",ui5Type:null,enumValues:null,isArray:!1};if(!e)return;const n=e.getType();if(!n)return;const o=n.getName();if(o){if(o.indexOf("[]")>0)t.primitiveType=o.substring(0,o.indexOf("[]")),t.isArray=!0;else if("void"===o||"object"===o)t.primitiveType=o;else if("any"===o)t.primitiveType="any";else if("boolean"===o||"string"===o||"int"===o||"float"===o)t.primitiveType=o;else{const e=window.sap.ui.base.DataType,n=e.getType(o);if(n&&!(n instanceof e))return t;Object.getPrototypeOf(n).getName()?t.primitiveType=Object.getPrototypeOf(n).getName():t.primitiveType="enum",t.ui5Type=o,"enum"===t.primitiveType&&(t.enumValues=jQuery.sap.getObject(t.ui5Type))}return t}}function f(e){return!e.isArray&&"any"!==e.primitiveType}function m(e){if(!("object"==typeof e&&e instanceof Object)||Array.isArray(e))return"function"==typeof e?"":e;try{return JSON.stringify(e)}catch(t){return t instanceof Error&&t.message.toLowerCase().includes("converting circular structure to json")?"<Circular JSON cannot be displayed>":e}}function v(e,t){var n,o;const a=e.getMetadata(),s=a.getName(),c=sap.ui.fl.Utils.checkControlId(e),l=t?t.getDesignTimeMetadata().getData().properties:void 0,p=a.getAllProperties(),u=Object.keys(p),d=[];for(const a of u){const u=p[a],v=g(u);if(!v)continue;let b=!1;l&&l[u.name]&&(b=l[u.name].ignore);const h={id:e.getId(),name:u.name,newValue:e.getProperty(u.name)},I=e.getBindingInfo(h.name);void 0!==(null==I?void 0:I.bindingString)&&(h.newValue=I.bindingString);const O=null!==(n=null==t?void 0:t.isSelectable())&&void 0!==n&&n&&f(v)&&c&&!b,w=m(h.newValue),C=y.test(u.name)&&"sap.m.Image"!==s&&"sap.ui.core.URI"===v.ui5Type;switch(v.primitiveType){case"enum":{const e=null!==(o=v.enumValues)&&void 0!==o?o:{},t=Object.keys(e).map((t=>({key:t,text:e[t]})));d.push({type:i,editor:"dropdown",name:u.name,value:w,isEnabled:O,options:t});break}case"string":d.push({type:i,editor:r,name:u.name,value:w,isEnabled:O,icons:C?sap.ui.core.IconPool.getIconNames().map((e=>{const t=sap.ui.core.IconPool.getIconInfo(e);return{name:e.toLowerCase(),content:t.content,fontFamily:t.fontFamily}})).sort(((e,t)=>e.name<t.name?-1:e.name>t.name?1:0)):[],isIcon:C});break;case"int":d.push({type:"integer",editor:r,name:u.name,value:w,isEnabled:O});break;case"float":d.push({type:"float",editor:r,name:u.name,value:w,isEnabled:O});break;case"boolean":d.push({type:"boolean",editor:"checkbox",name:u.name,value:w,isEnabled:O})}}return{id:e.getId(),type:s,properties:d.sort(((e,t)=>e.name>t.name?1:-1))}}function b(e){return!(!e.startsWith("{")||!e.endsWith("}"))}const h=(e="")=>{let t=!1;const n=sap.ui.getCore().byId(e);if(n){let e=sap.ui.dt.OverlayRegistry.getOverlay(n);if(e&&e.getDomRef()||(e=sap.ui.dt.OverlayUtil.getClosestOverlayFor(n)),e){t=void 0!==v(e.getElementInstance(),e).properties.find((e=>!0===e.isEnabled))}}else{const n=sap.ui.getCore().getComponent(e);if(n){t=void 0!==v(n).properties.find((e=>!0===e.isEnabled))}}return t};function I(e,t){var n,o;const i=[...e],r=[];for(;i.length;){const e=i.shift(),a=h(null==e?void 0:e.id);if("element"===(null==e?void 0:e.type)){const i=(null!==(n=e.elements)&&void 0!==n?n:[]).flatMap((e=>{var t;return"aggregation"===e.type&&null!==(t=e.elements)&&void 0!==t?t:[]})),{text:s}=t(e.id),c={controlId:e.id,controlType:e.technicalName,name:null!=s?s:e.technicalName.split(".").slice(-1)[0],editable:a,visible:null===(o=e.visible)||void 0===o||o,children:I(i,t)};r.push(c)}}return r}async function O(e,t){const n=await e.getService("outline");n.attachEvent("update",(async function(){const e=I(await n.get(),(e=>{const t=sap.ui.getCore().byId(e);if(t&&t.getMetadata().getProperty("text")){const e=t.getProperty("text");return"string"==typeof e&&""!==e.trim()?{text:e}:{}}return{}}));t(p(e))}))}function w(e){console.log("Initializing Control Property Editor");const{rta:t}=e;try{const{sendAction:n}=o(window.parent,(async function(o){if(u.match(o))try{await async function(e,t){const{layer:n,componentId:o,rta:i,generator:r}=e,a=sap.ui.getCore().byId(t.controlId);if(!a)return;const s={layer:n,developerMode:!0,baseId:o,projectId:"",scenario:"FE_FROM_SCRATCH"},c="string"==typeof t.value&&b(t.value)?"BindProperty":"Property",l="string"==typeof t.value&&b(t.value)?{propertyName:t.propertyName,newBinding:t.value}:{propertyName:t.propertyName,newValue:t.value},p=await sap.ui.rta.command.CommandFactory.getCommandFor(a,c,l,null,s);p.getPreparedChange().getDefinition().support.generator=r,await i.getCommandStack().pushAndExecute(p)}(e,o.payload)}catch(e){let t="";const i=o.payload.controlId||"",r=sap.ui.getCore().byId(i);r&&(t=r.getMetadata().getName());const a=function(e,t,n){return e.replace("Error: Applying property changes failed:","").replace(`${n}#${t}`,"")}(null==e?void 0:e.toString(),i,t),s=a||`RTA Exception applying expression "${o.payload.value}"`,c=d({...o.payload,errorMessage:s});n(c)}else if(l.match(o)){const e=o.payload,i=sap.ui.getCore().byId(e);if(!i){const t=sap.ui.getCore().getComponent(e);if(t){const e=v(t),o=c(e);n(o)}return}let r=sap.ui.dt.OverlayRegistry.getOverlay(i);const a=t.getSelection();if(a.length>0)for(let e=0;e<a.length;e++)a[e].setSelected(!1);if(r&&r.getDomRef()||(r=sap.ui.dt.OverlayUtil.getClosestOverlayFor(i)),r&&r.isSelectable())r.setSelected(!0);else{const e=v(i),t=c(e);n(t)}}}));t.attachSelectionChange(function(e){return function(t){const n=t.getParameter("selection");if(Array.isArray(n)&&1===n.length){const t=sap.ui.getCore().byId(n[0].getId());if(t){const n=v(t.getElementInstance(),t),o=c(n);e(o)}}}}(n)),O(t,n)}catch(e){console.error("Error during initialization of Control Property Editor",e)}}self["ui5-adaptation"]=t})();